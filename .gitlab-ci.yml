
default:
    tags:
    - ChocoBuilder
    stage: build

    script: 
        - $f='tools/chocolateyinstall.ps1'
        - gc $f | ? {$_ -notmatch "^\s*#"} | % {$_ -replace '(^.*?)\s*?[^``]#.*','$1'} | Out-File $f+".~" -en utf8; mv -fo $f+".~" $f
        - $f='tools/chocolateyuninstall.ps1'
        - gc $f | ? {$_ -notmatch "^\s*#"} | % {$_ -replace '(^.*?)\s*?[^``]#.*','$1'} | Out-File $f+".~" -en utf8; mv -fo $f+".~" $f
        - $f='tools/chocolateybeforemodify.ps1'
        - gc $f | ? {$_ -notmatch "^\s*#"} | % {$_ -replace '(^.*?)\s*?[^``]#.*','$1'} | Out-File $f+".~" -en utf8; mv -fo $f+".~" $f
        - choco pack 
        - choco push --force -s "http://172.16.129.140:8081/repository/chocolatey-repo-internal/" --api-key="f3adb985-58cf-3c03-b073-f2b99f10c2bd"
